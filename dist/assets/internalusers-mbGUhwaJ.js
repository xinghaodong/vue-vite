import{r as $,a as h,o as M,k as O,b as d,c as _,d as v,e as x,f as e,w as n,l as r,j as G,g as f,i as V,t as J,h as W}from"./index-vnRDGDmm.js";const H={class:"mb-4"},K={key:0},Q={key:1},X=["src"],Y={class:"dialog-footer"},ae={__name:"internalusers",setup(Z){const{proxy:o}=G(),w=$([]),m=$(null),C=`${o.$api.baseUrl}/api/upload/uploadFile`,B={Authorization:localStorage.getItem("token")},y={username:"",name:"",email:"",role:"",is_active:""};let l=h({...y});const U={name:[{required:!0,message:"请输入账号",trigger:"blur"}],username:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{required:!1,message:"请输入邮箱"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}]},T=()=>{l=h({...y}),m.value&&m.value.resetFields()},c=$(!1);M(()=>{p()}),O(()=>{});const z=(s,a)=>{l.user_pic=URL.createObjectURL(a.raw),l.avatar_url=s.data.avatarPath},F=s=>s.type!="image/jpeg"&&s.type!="image/png"?(o.$message.error(" picture must be JPG format!"),!1):s.size/1024/1024>5?(o.$message.error(" picture size can not exceed 5MB!"),!1):!0,p=async()=>{const s=await o.$api.find();w.value=s.data},R=s=>{s.validate(async a=>{if(a){if(l.id){const u=await o.$api.update(l);u.code==200&&(c.value=!1,o.$message.success(u.message),p());return}console.log(l,"555");const i=await o.$api.add(l);i.code==200&&(c.value=!1,o.$message.success(i.message),p())}else return!1})},j=s=>{c.value=!0,Object.assign(l,s),console.log(l.avatar_url,"ruleForm")},D=s=>{o.$messageBox.confirm("确定要删除吗?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const a=await o.$api.delete({id:s.id});a.code==200&&(o.$message.success(a.message),p())}).catch(()=>{o.$message.info("已取消")})},N=s=>{let a={id:s.id,is_active:s.is_active===1?0:1};o.$confirm("此操作将该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const i=await o.$api.post("/api/internalusers/ban",a);i.code==200&&(o.$message.success(i.message),p())}).catch(async()=>{await o.$message.info("已取消")})};return(s,a)=>{const i=d("el-button"),u=d("el-table-column"),P=d("el-image"),S=d("el-table"),b=d("el-input"),g=d("el-form-item"),q=d("Plus"),A=d("el-icon"),I=d("el-upload"),E=d("el-form"),L=d("el-dialog");return _(),v("div",null,[x("div",H,[e(i,{type:"primary",onClick:a[0]||(a[0]=t=>{c.value=!0,T(m.value)})},{default:n(()=>[f("新增")]),_:1})]),e(S,{data:w.value,border:"",style:{width:"100%"}},{default:n(()=>[e(u,{prop:"name",label:"账号",width:"180"}),e(u,{prop:"username",label:"姓名",width:"180"}),e(u,{prop:"email",label:"邮箱",width:"180"}),e(u,{prop:"role",label:"权限"}),e(u,{prop:"is_active",label:"状态"},{default:n(t=>[t.row.is_active==1?(_(),v("span",K,"可用")):V("",!0),t.row.is_active==0?(_(),v("span",Q,"禁用")):V("",!0)]),_:1}),e(u,{prop:"avatar",label:"头像",center:""},{default:n(t=>[e(P,{style:{width:"45px",height:"45px"},src:`${r(o).$api.img_url}${t.row.avatar_url}`,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"initial-index":0,"z-index":999,fit:"cover","preview-src-list":[`${r(o).$api.img_url}${t.row.avatar_url}`]},null,8,["src","preview-src-list"])]),_:1}),e(u,{prop:"created_at",label:"创建时间",width:"180"}),e(u,{prop:"updated_at",label:"更新时间",width:"180"}),e(u,{label:"操作",width:"180"},{default:n(t=>[e(i,{link:"",type:"primary",onClick:k=>j(t.row)},{default:n(()=>[f("编辑")]),_:2},1032,["onClick"]),e(i,{link:"",type:"primary",onClick:k=>D(t.row)},{default:n(()=>[f("删除")]),_:2},1032,["onClick"]),e(i,{link:"",type:"primary",onClick:k=>N(t.row),textContent:J(t.row.is_active==0?"解除":"禁用")},null,8,["onClick","textContent"])]),_:1})]),_:1},8,["data"]),e(L,{title:r(l).id?"编辑":"新增",modelValue:c.value,"onUpdate:modelValue":a[6]||(a[6]=t=>c.value=t),width:"50%"},{footer:n(()=>[x("span",Y,[e(i,{onClick:a[4]||(a[4]=t=>c.value=!1)},{default:n(()=>[f("取 消")]),_:1}),e(i,{type:"primary",onClick:a[5]||(a[5]=t=>R(m.value))},{default:n(()=>[f("确 定")]),_:1})])]),default:n(()=>[e(E,{ref_key:"ruleFormRef",ref:m,rules:U,model:r(l),"label-width":"100px"},{default:n(()=>[e(g,{label:"账号",prop:"name"},{default:n(()=>[e(b,{modelValue:r(l).name,"onUpdate:modelValue":a[1]||(a[1]=t=>r(l).name=t)},null,8,["modelValue"])]),_:1}),e(g,{label:"姓名",prop:"username"},{default:n(()=>[e(b,{modelValue:r(l).username,"onUpdate:modelValue":a[2]||(a[2]=t=>r(l).username=t)},null,8,["modelValue"])]),_:1}),e(g,{label:"邮箱",prop:"email"},{default:n(()=>[e(b,{modelValue:r(l).email,"onUpdate:modelValue":a[3]||(a[3]=t=>r(l).email=t)},null,8,["modelValue"])]),_:1}),e(g,{label:"头像"},{default:n(()=>[e(I,{action:C,class:"avatar-uploader","show-file-list":!1,"on-success":z,"before-upload":F,headers:B,data:{id:r(l).id}},{default:n(()=>[r(l).avatar_url?(_(),v("img",{key:0,src:r(o).$api.img_url+r(l).avatar_url,class:"avatar"},null,8,X)):(_(),W(A,{key:1,class:"avatar-uploader-icon"},{default:n(()=>[e(q)]),_:1}))]),_:1},8,["data"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}};export{ae as default};
