import{r as g,u as j,s as z,a as E,o as M,b as s,c as b,d as P,e as y,f as a,w as n,g as m,h as V,i as k,j as L}from"./index-vnRDGDmm.js";const O={class:"mb-4"},W={class:"dialog-footer"},A="100px",J={__name:"index",setup(G){const{proxy:d}=L(),u=g(!1),w=j();z(w);const i=g(),C={children:"children",label:"name"},x={name:[{required:!0,message:"请输入菜单名字",trigger:"blur"}],parent_id:[{required:!1,message:"请选择上级菜单",trigger:"change"}],url:[{required:!1,message:"请输入菜单地址",trigger:"blur"}]},o=E({name:"",parent_id:0,url:""}),f=g(null),$=l=>{l()},h=l=>{console.log(l)},U=()=>{i.value&&i.value.resetFields()},B=l=>{l.validate(async e=>{if(!e)return!1;if(o.id)d.$api.updatemenu(o).then(r=>{r.code==200&&(d.$message.success(r.message),u.value=!1,c())});else{o.parent_id==0&&(o.parent_id="");const r=await d.$api.addmenu(o);r.code==200&&(u.value=!1,d.$message.success(r.message),c())}})},F=async l=>{const e=await d.$api.deletemenu({id:l});e.code==200&&(d.$message.success(e.message),c())},N=async l=>{u.value=!0,Object.assign(o,l)},c=async()=>{const l=await d.$api.menus(),e=T(l.data);f.value=e},T=l=>[{parent_id:"",name:"顶级菜单",id:0,children:l}];return M(async()=>{try{await c()}catch(l){console.error("失败信息:",l)}}),(l,e)=>{const r=s("el-button"),p=s("el-table-column"),q=s("el-table"),v=s("el-input"),_=s("el-form-item"),D=s("el-tree-select"),I=s("el-form"),R=s("el-dialog");return b(),P("div",null,[y("div",O,[a(r,{type:"primary",onClick:e[0]||(e[0]=t=>{u.value=!0,U(i.value)})},{default:n(()=>[m("新增")]),_:1})]),a(q,{data:f.value,style:{width:"100%","margin-bottom":"20px"},"row-key":"id",border:"","default-expand-all":""},{default:n(()=>[a(p,{prop:"name",label:"菜单名"}),a(p,{prop:"url",label:"菜单名地址"}),a(p,{prop:"id",label:"id"}),a(p,{label:"操作",width:"140",align:"left"},{default:n(t=>[t.row.id?(b(),V(r,{key:0,type:"text",size:"small",onClick:S=>F(t.row.id)},{default:n(()=>[m("删除")]),_:2},1032,["onClick"])):k("",!0),t.row.id?(b(),V(r,{key:1,type:"text",size:"small",onClick:S=>N(t.row)},{default:n(()=>[m("修改")]),_:2},1032,["onClick"])):k("",!0)]),_:1})]),_:1},8,["data"]),a(R,{modelValue:u.value,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value=t),title:o.id?"修改菜单":"新增菜单",width:"500","before-close":$},{footer:n(()=>[y("div",W,[a(r,{onClick:e[5]||(e[5]=t=>u.value=!1)},{default:n(()=>[m("取消")]),_:1}),a(r,{type:"primary",onClick:e[6]||(e[6]=t=>B(i.value))},{default:n(()=>[m(" 确定 ")]),_:1})])]),default:n(()=>[a(I,{model:o,"label-width":A,rules:x,ref_key:"ruleFormRef",ref:i},{default:n(()=>[a(_,{label:"菜单名称",prop:"name"},{default:n(()=>[a(v,{modelValue:o.name,"onUpdate:modelValue":e[1]||(e[1]=t=>o.name=t),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(_,{label:"上级菜单",prop:"parent_id"},{default:n(()=>[a(D,{onChange:e[2]||(e[2]=t=>h(t)),modelValue:o.parent_id,"onUpdate:modelValue":e[3]||(e[3]=t=>o.parent_id=t),"node-key":"id",data:f.value,props:C,"check-strictly":"","render-after-expand":!1,placeholder:"请选择上级菜单"},null,8,["modelValue","data"])]),_:1}),a(_,{label:"菜单地址",prop:"url"},{default:n(()=>[a(v,{modelValue:o.url,"onUpdate:modelValue":e[4]||(e[4]=t=>o.url=t),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{J as default};
